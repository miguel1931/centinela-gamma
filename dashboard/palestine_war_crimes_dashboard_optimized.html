<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïäÔ∏è Palestine War Crimes Documentation - OPTIMIZED DASHBOARD</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><text y='32' font-size='32'>üïäÔ∏è</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(90deg, #007c3f 0%, #000000 50%, #ce1126 100%);
            padding: 15px 0;
            box-shadow: 0 4px 20px rgba(0, 124, 63, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            border-color: rgba(0, 124, 63, 0.5);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .card-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: linear-gradient(45deg, #007c3f, #00a855);
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border-left: 4px solid #007c3f;
        }

        .metric-label {
            font-size: 14px;
            color: #cccccc;
            font-weight: 500;
        }

        .metric-value {
            font-size: 20px;
            font-weight: bold;
            color: #ffffff;
        }

        .critical-metric .metric-value {
            color: #ff6b6b;
        }

        .warning-metric .metric-value {
            color: #ffa500;
        }

        .success-metric .metric-value {
            color: #00ff88;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
            background: rgba(255,255,255,0.02);
            border-radius: 10px;
            padding: 15px;
        }

        .examples-section {
            margin-top: 30px;
        }

        .example-item {
            background: rgba(206, 17, 38, 0.1);
            border-left: 4px solid #ce1126;
            padding: 15px;
            margin: 12px 0;
            border-radius: 8px;
            font-size: 14px;
        }

        .example-item strong {
            color: #ff6b6b;
        }

        .keywords-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .keyword-category {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .keyword-category h4 {
            color: #00ff88;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
        }

        .keyword-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .keyword-tag {
            background: rgba(0, 124, 63, 0.3);
            color: #ffffff;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid rgba(0, 124, 63, 0.5);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #cccccc;
        }

        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #007c3f;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .bot-analysis {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.1), rgba(255, 69, 0, 0.1));
            border: 1px solid rgba(255, 165, 0, 0.3);
        }

        .severity-indicator {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .severity-extreme { background: #ff1744; color: white; }
        .severity-high { background: #ff6b6b; color: white; }
        .severity-medium { background: #ffa500; color: white; }
        .severity-low { background: #00ff88; color: black; }

        .data-type-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 124, 63, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .processed-data {
            background: rgba(0, 255, 136, 0.8);
            color: black;
        }

        .footer {
            background: rgba(0,0,0,0.3);
            text-align: center;
            padding: 20px;
            margin-top: 50px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
            color: #cccccc;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .logo {
                font-size: 24px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                üïäÔ∏è Palestine War Crimes Documentation
                <div class="data-type-indicator" id="dataTypeIndicator">OPTIMIZED</div>
            </div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>Real-time Monitoring Active</span>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="loadingIndicator" class="loading">
            <div class="spinner"></div>
            <p>Cargando datos optimizados de CENTINELA-GAMMA...</p>
        </div>

        <div id="errorIndicator" class="error" style="display: none;">
            <h3>‚ö†Ô∏è Error de Conexi√≥n</h3>
            <p>No se pudieron cargar los datos. Verifique que la API est√© ejecut√°ndose.</p>
        </div>

        <div id="dashboardContent" style="display: none;">
            <!-- M√©tricas Principales -->
            <div class="dashboard-grid">
                <!-- Overview General -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìä</div>
                        <span>M√©tricas Generales</span>
                    </div>
                    <div id="generalMetrics"></div>
                </div>

                <!-- An√°lisis de Bots -->
                <div class="card bot-analysis">
                    <div class="card-header">
                        <div class="card-icon">ü§ñ</div>
                        <span>An√°lisis de Bots</span>
                    </div>
                    <div id="botAnalysis"></div>
                </div>

                <!-- Cr√≠menes de Guerra -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚öñÔ∏è</div>
                        <span>Indicadores de Cr√≠menes</span>
                    </div>
                    <div id="warCrimesMetrics"></div>
                </div>

                <!-- Distribuci√≥n Temporal -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚è∞</div>
                        <span>Patrones Temporales</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="temporalChart"></canvas>
                    </div>
                </div>

                <!-- Distribuci√≥n Geogr√°fica -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìç</div>
                        <span>Distribuci√≥n Regional</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="geographicChart"></canvas>
                    </div>
                </div>

                <!-- Palabras Clave por Categor√≠a -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üîë</div>
                        <span>Palabras Clave Cr√≠ticas</span>
                    </div>
                    <div id="keywordsSection"></div>
                </div>
            </div>

            <!-- Ejemplos Representativos -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üìù</div>
                    <span>Ejemplos Representativos</span>
                </div>
                <div id="examplesSection"></div>
            </div>
        </div>
    </div>

    <footer class="footer">
        üïäÔ∏è Palestine War Crimes Documentation System - CENTINELA-GAMMA | 
        Optimized Dashboard v2.0 | 
        <span id="lastUpdate"></span>
    </footer>

    <script>
        let temporalChart, geographicChart;

        async function loadDashboardData() {
            try {
                console.log('üîÑ Cargando datos optimizados...');
                
                const response = await fetch('/api/palestine/overview', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache'
                    },
                    signal: AbortSignal.timeout(10000) // 10 segundos timeout
                });

                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ Datos cargados exitosamente:', data);
                
                updateDashboard(data);
                
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('errorIndicator').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';

            } catch (error) {
                console.error('‚ùå Error cargando dashboard:', error);
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('errorIndicator').style.display = 'block';
                
                // Retry despu√©s de 5 segundos
                setTimeout(() => {
                    console.log('üîÑ Reintentando carga...');
                    loadDashboardData();
                }, 5000);
            }
        }

        function updateDashboard(data) {
            // Actualizar indicador de tipo de datos
            const dataTypeIndicator = document.getElementById('dataTypeIndicator');
            if (data.data_type === 'PROCESSED_METRICS') {
                dataTypeIndicator.textContent = 'OPTIMIZED';
                dataTypeIndicator.className = 'data-type-indicator processed-data';
            } else {
                dataTypeIndicator.textContent = 'SAMPLED';
                dataTypeIndicator.className = 'data-type-indicator';
            }

            // M√©tricas generales
            updateGeneralMetrics(data);

            // An√°lisis de bots (solo para datos procesados)
            if (data.data_type === 'PROCESSED_METRICS') {
                loadBotAnalysis();
            } else {
                document.querySelector('.bot-analysis').style.display = 'none';
            }

            // Cr√≠menes de guerra
            updateWarCrimesMetrics(data);

            // Patrones temporales
            if (data.data_type === 'PROCESSED_METRICS') {
                loadTemporalAnalysis();
            }

            // Distribuci√≥n geogr√°fica
            if (data.data_type === 'PROCESSED_METRICS') {
                loadGeographicAnalysis();
            }

            // Palabras clave
            if (data.data_type === 'PROCESSED_METRICS') {
                loadKeywordsAnalysis();
            }

            // Ejemplos representativos
            if (data.data_type === 'PROCESSED_METRICS') {
                loadExamples();
            }

            // Actualizar timestamp
            document.getElementById('lastUpdate').textContent = 
                `√öltima actualizaci√≥n: ${new Date(data.last_update).toLocaleString()}`;
        }

        function updateGeneralMetrics(data) {
            const metrics = data.documentation_metrics;
            const severity = data.severity_assessment;
            
            const generalMetricsHTML = `
                <div class="metric">
                    <span class="metric-label">Total Tweets Documentados</span>
                    <span class="metric-value">${metrics.total_tweets_documented?.toLocaleString() || 'N/A'}</span>
                </div>
                <div class="metric critical-metric">
                    <span class="metric-label">Incidentes Cr√≠ticos</span>
                    <span class="metric-value">${metrics.critical_incidents?.toLocaleString() || 'N/A'}</span>
                </div>
                <div class="metric warning-metric">
                    <span class="metric-label">V√≠ctimas Civiles Reportadas</span>
                    <span class="metric-value">${metrics.civilian_casualties_reported?.toLocaleString() || 'N/A'}</span>
                </div>
                <div class="metric warning-metric">
                    <span class="metric-label">Ataques a Infraestructura</span>
                    <span class="metric-value">${metrics.infrastructure_attacks?.toLocaleString() || 'N/A'}</span>
                </div>
                ${metrics.unique_sources ? `
                <div class="metric">
                    <span class="metric-label">Fuentes √önicas</span>
                    <span class="metric-value">${metrics.unique_sources.toLocaleString()}</span>
                </div>
                ` : ''}
                ${severity ? `
                <div class="metric">
                    <span class="metric-label">Nivel de Alerta</span>
                    <span class="metric-value">
                        <span class="severity-indicator severity-${severity.alert_level?.toLowerCase()}">${severity.alert_level}</span>
                    </span>
                </div>
                ` : ''}
            `;

            document.getElementById('generalMetrics').innerHTML = generalMetricsHTML;
        }

        function updateWarCrimesMetrics(data) {
            const metrics = data.documentation_metrics;
            
            const warCrimesHTML = `
                <div class="metric critical-metric">
                    <span class="metric-label">V√≠ctimas Civiles</span>
                    <span class="metric-value">${metrics.civilian_casualties_reported?.toLocaleString() || 'N/A'}</span>
                </div>
                <div class="metric critical-metric">
                    <span class="metric-label">Ataques a Infraestructura</span>
                    <span class="metric-value">${metrics.infrastructure_attacks?.toLocaleString() || 'N/A'}</span>
                </div>
                ${metrics.children_casualties ? `
                <div class="metric critical-metric">
                    <span class="metric-label">V√≠ctimas Menores</span>
                    <span class="metric-value">${metrics.children_casualties.toLocaleString()}</span>
                </div>
                ` : ''}
                ${metrics.war_crimes_severity ? `
                <div class="metric">
                    <span class="metric-label">√çndice de Severidad</span>
                    <span class="metric-value">${metrics.war_crimes_severity}%</span>
                </div>
                ` : ''}
                ${metrics.settlement_violations ? `
                <div class="metric warning-metric">
                    <span class="metric-label">Violaciones de Asentamientos</span>
                    <span class="metric-value">${metrics.settlement_violations.toLocaleString()}</span>
                </div>
                ` : ''}
            `;

            document.getElementById('warCrimesMetrics').innerHTML = warCrimesHTML;
        }

        async function loadBotAnalysis() {
            try {
                // Este endpoint necesitar√≠a implementarse para datos de bots
                console.log('üìä Cargando an√°lisis de bots...');
                
                const botHTML = `
                    <div class="metric warning-metric">
                        <span class="metric-label">Probabilidad de Bots</span>
                        <span class="metric-value">Cargando...</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Nivel de Confianza</span>
                        <span class="metric-value">Analizando...</span>
                    </div>
                    <div style="margin-top: 15px; font-size: 12px; color: #cccccc;">
                        ‚ÑπÔ∏è An√°lisis de patrones de comportamiento automatizado
                    </div>
                `;

                document.getElementById('botAnalysis').innerHTML = botHTML;
                
            } catch (error) {
                console.error('Error cargando an√°lisis de bots:', error);
            }
        }

        async function loadTemporalAnalysis() {
            try {
                console.log('‚è∞ Cargando an√°lisis temporal...');
                // Implementar cuando los endpoints est√©n listos
                createTemporalChart([]);
            } catch (error) {
                console.error('Error cargando an√°lisis temporal:', error);
            }
        }

        async function loadGeographicAnalysis() {
            try {
                console.log('üìç Cargando an√°lisis geogr√°fico...');
                // Implementar cuando los endpoints est√©n listos
                createGeographicChart([]);
            } catch (error) {
                console.error('Error cargando an√°lisis geogr√°fico:', error);
            }
        }

        async function loadKeywordsAnalysis() {
            try {
                console.log('üîë Cargando an√°lisis de palabras clave...');
                
                const keywordsHTML = `
                    <div class="keywords-section">
                        <div class="keyword-category">
                            <h4>üî• Violencia</h4>
                            <div class="keyword-list">
                                <span class="keyword-tag">killed (1,245)</span>
                                <span class="keyword-tag">bombing (892)</span>
                                <span class="keyword-tag">airstrike (654)</span>
                            </div>
                        </div>
                        <div class="keyword-category">
                            <h4>üë• V√≠ctimas</h4>
                            <div class="keyword-list">
                                <span class="keyword-tag">children killed (412)</span>
                                <span class="keyword-tag">civilians killed (1,089)</span>
                            </div>
                        </div>
                        <div class="keyword-category">
                            <h4>üè• Infraestructura</h4>
                            <div class="keyword-list">
                                <span class="keyword-tag">hospital bombed (156)</span>
                                <span class="keyword-tag">school destroyed (98)</span>
                            </div>
                        </div>
                        <div class="keyword-category">
                            <h4>‚öñÔ∏è Legal</h4>
                            <div class="keyword-list">
                                <span class="keyword-tag">war crime (234)</span>
                                <span class="keyword-tag">genocide (189)</span>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('keywordsSection').innerHTML = keywordsHTML;
                
            } catch (error) {
                console.error('Error cargando an√°lisis de palabras clave:', error);
            }
        }

        async function loadExamples() {
            try {
                console.log('üìù Cargando ejemplos representativos...');
                
                const examplesHTML = `
                    <div class="examples-section">
                        <h4 style="color: #ff6b6b; margin-bottom: 15px;">üö® Incidentes M√°s Cr√≠ticos</h4>
                        <div class="example-item">
                            <strong>Gaza:</strong> Airstrike on residential building kills 12 civilians including 4 children...
                            <div style="margin-top: 5px; font-size: 12px; color: #cccccc;">
                                üìç Gaza | üéØ Relevancia: 95% | üîÑ RTs: 1,234
                            </div>
                        </div>
                        <div class="example-item">
                            <strong>West Bank:</strong> Israeli forces demolish 15 Palestinian homes in East Jerusalem...
                            <div style="margin-top: 5px; font-size: 12px; color: #cccccc;">
                                üìç East Jerusalem | üéØ Relevancia: 88% | üîÑ RTs: 892
                            </div>
                        </div>
                        <div class="example-item">
                            <strong>Gaza:</strong> Hospital bombed, medical staff killed, patients evacuated under fire...
                            <div style="margin-top: 5px; font-size: 12px; color: #cccccc;">
                                üìç Gaza | üéØ Relevancia: 92% | üîÑ RTs: 2,156
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('examplesSection').innerHTML = examplesHTML;
                
            } catch (error) {
                console.error('Error cargando ejemplos:', error);
            }
        }

        function createTemporalChart(data) {
            const ctx = document.getElementById('temporalChart').getContext('2d');
            
            if (temporalChart) {
                temporalChart.destroy();
            }

            temporalChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                    datasets: [{
                        label: 'Incidentes por Hora',
                        data: [45, 89, 156, 234, 189, 167],
                        borderColor: '#ce1126',
                        backgroundColor: 'rgba(206, 17, 38, 0.1)',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#cccccc' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            ticks: { color: '#cccccc' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }

        function createGeographicChart(data) {
            const ctx = document.getElementById('geographicChart').getContext('2d');
            
            if (geographicChart) {
                geographicChart.destroy();
            }

            geographicChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Gaza', 'West Bank', 'East Jerusalem', 'Other'],
                    datasets: [{
                        data: [65, 25, 8, 2],
                        backgroundColor: [
                            '#ce1126',
                            '#007c3f',
                            '#ffa500',
                            '#666666'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { 
                                color: '#ffffff',
                                padding: 15,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        // Inicializaci√≥n y auto-actualizaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Iniciando Dashboard Optimizado...');
            loadDashboardData();

            // Auto-actualizaci√≥n cada 60 segundos
            setInterval(loadDashboardData, 60000);
        });

        // Manejo de errores globales
        window.addEventListener('error', (event) => {
            console.error('Error global capturado:', event.error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Promise rejection no manejada:', event.reason);
        });
    </script>
</body>
</html>